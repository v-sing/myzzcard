<?php
namespace Org\Util;
class idCard{
    private $regionCode;
    private $startYear;
    private $endYear;

    function __construct(){
        $this->birthYear();
        $this->regionCode();
    }

    private function birthYear(){
        $this->startYear=mktime(0,0,0,1,1,1941);
        $this->endYear=mktime(0,0,0,1,1,1998);
    }
    private function regionCode(){
        $this->regionCode=array(
            "410101","410102","410103","410104","410105","410106","410108","410122","410181","410182","410183","410184",
            "410185","410200","410201","410202","410203","410204","410205","410211","410221","410222","410223","410224",
            "410300","410301","410302","410303","410304","410305","410306","410307","410322","410323","410324","410325",
            "410326","410327","410328","410329","410381","410400","410401","410402","410403","410404","410411","410421",
            "410422","410423","410425","410481","410482","410500","410501","410502","410503","410505","410506","410523",
            "410526","410527","410581","410600","410601","410602","410603","410611","410621","410622","410700","410701",
            "410702","410703","410704","410711","410721","410724","410725","410726","410727","410728","410781","410782",
            "410800","410801","410802","410803","410804","410811","410821","410822","410823","410825","410881","410882",
            "410883","410900","410901","410902","410922","410923","410926","410927","410928","411000","411001","411002",
            "411023","411024","411025","411081","411082","411100","411101","411102","411103","411104","411121","411122",
            "411200","411201","411202","411221","411222","411224","411281","411282","411300","411301","411302","411303",
            "411321","411322","411323","411324","411325","411326","411327","411328","411329","411330","411381","411400",
            "411401","411402","411403","411421","411422","411423","411424","411425","411426","411481","411500","411501",
            "411502","411503","411521","411522","411523","411524","411525","411526","411527","411528","411600","411601",
            "411602","411621","411622","411623","411624","411625","411626","411627","411628","411681","411700","411701",
            "411702","411721","411722","411723","411724","411725","411726","411727","411728","411729","632324","410225"
        );
    }
    function calc_suffix_d ($base){
        if (strlen($base) <> 17){
            die('Invalid Length');
        }
        $factor = array(7,9,10,5,8,4,2,1,6,3,7,9,10,5,8,4,2);
        $sums = 0;
        for ($i=0;$i< 17;$i++){

            $sums += substr($base,$i,1) * $factor[$i];
        }

        $mods = $sums % 11;//10X98765432

        switch ($mods){
            case 0:  return '1';break;
            case 1:  return '0';break;
            case 2:  return 'x';break;
            case 3:  return '9';break;
            case 4:  return '8';break;
            case 5:  return '7';break;
            case 6:  return '6';break;
            case 7:  return '5';break;
            case 8:  return '4';break;
            case 9:  return '3';break;
            case 10: return '2';break;

        }
    }
    function getIdCard(){
        $seed = mt_rand(0,count($this->regionCode));
        $Birth = mt_rand($this->startYear,$this->endYear);
        $Birth_format = date('Ymd',$Birth);
        $suffix_a = mt_rand(0,9);
        $suffix_b = mt_rand(0,9);
        $suffix_c = mt_rand(0,9);//male or female
        $base = $this->regionCode[$seed].$Birth_format.$suffix_a.$suffix_b.$suffix_c;
        $checkCode=$this->calc_suffix_d($base);
        if($base=='10'){
            $checkCode='X';
        }
        $idCard=$base.$checkCode;
        return $idCard;
    }
}