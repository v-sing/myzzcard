<link rel="stylesheet" type="text/css" href="__PUBLIC__/uploadify/uploadify.css">
<style>
  table {
    max-width: 100%;
    background-color: transparent;
    border-spacing: 0;
  }
  .table-bordered {
    border: 1px solid #dddddd;
    border-collapse: separate;
    border-left: 0;
    border-radius: 4px;
  }
  .table th, .table td {
    padding: 8px;
    vertical-align: top;
    border-top: 1px solid #dddddd;
  }
  .table td, .table th {
    padding-top: 8px;
    padding-bottom: 4px;
    line-height: 20px;
    height: 25px;
  }
  .table-bordered th, .table-bordered td {
    border-left: 1px solid #dddddd;
  }
  tr {
    display: table-row;
    vertical-align: inherit;
    border-color: inherit;
    }
  td, th {
    border-bottom:1px solid #dddddd;
    display: table-cell;
  }
  .status {
    display: none;
    position: absolute;
    width: 40px;
    height: 40px;
    bottom: 20px;
    right: 0;
    background: url(../images/success.png) no-repeat;
    _background: url(../images/success.gif) no-repeat;
    z-index: 2;
    }
    .filelist {
    list-style: none;
    margin: 0;
    padding: 0;
    }
    .filelist li {
    width: 110px;
    height: 110px;
    background: url(../images/bg.png) no-repeat;
    text-align: center;
    margin: 0 8px 20px 0;
    position: relative;
    display: inline;
    float: left;
    overflow: hidden;
    font-size: 12px;
  }
  
  .filelist li p.title {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    overflow: hidden;
    white-space: nowrap;
    text-overflow: ellipsis;
    top: 5px;
    text-indent: 5px;
    text-align: left;
}
    .filelist1 {
    list-style: none;
    margin: 0;
    padding: 0;
    }
    .filelist1 li {
    width: 110px;
    height: 110px;
    background: url(../images/bg.png) no-repeat;
    text-align: center;
    margin: 0 8px 20px 0;
    position: relative;
    display: inline;
    float: left;
    overflow: hidden;
    font-size: 12px;
  }
  
  .filelist1 li p.title {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    overflow: hidden;
    white-space: nowrap;
    text-overflow: ellipsis;
    top: 5px;
    text-indent: 5px;
    text-align: left;
}
  p.imgWrap {
    position: relative;
    z-index: 2;
    line-height: 110px;
    vertical-align: middle;
    overflow: hidden;
    width: 110px;
    height: 110px;
    color: #1094FA;
    font-size: 14px;
    -webkit-transform-origin: 50% 50%;
    -moz-transform-origin: 50% 50%;
    -o-transform-origin: 50% 50%;
    -ms-transform-origin: 50% 50%;
    transform-origin: 50% 50%;
    -webit-transition: 200ms ease-out;
    -moz-transition: 200ms ease-out;
    -o-transition: 200ms ease-out;
    -ms-transition: 200ms ease-out;
    transition: 200ms ease-out;
}
.filelist li img {
    width: 100%;
}
.filelist div.file-panel {
    position: absolute;
    height: 0;
    filter: progid:DXImageTransform.Microsoft.gradient(GradientType=0,startColorstr='#80000000', endColorstr='#80000000')\0;
    background: rgba( 0, 0, 0, 0.5 );
    width: 100%;
    top: 0;
    left: 0;
    overflow: hidden;
    z-index: 300;
}
.filelist div.file-panel span {
    width: 24px;
    height: 24px;
    display: inline;
    float: right;
    text-indent: -9999px;
    overflow: hidden;
    background: url(../images/icons.png) no-repeat;
    _background: url(../images/icons.gif) no-repeat;
    margin: 5px 1px 1px;
    cursor: pointer;
}
.filelist1 li img {
    width: 100%;
}
.filelist1 div.file-panel {
    position: absolute;
    height: 0;
    filter: progid:DXImageTransform.Microsoft.gradient(GradientType=0,startColorstr='#80000000', endColorstr='#80000000')\0;
    background: rgba( 0, 0, 0, 0.5 );
    width: 100%;
    top: 0;
    left: 0;
    overflow: hidden;
    z-index: 300;
}
.filelist1 div.file-panel span {
    width: 24px;
    height: 24px;
    display: inline;
    float: right;
    text-indent: -9999px;
    overflow: hidden;
    background: url(../images/icons.png) no-repeat;
    _background: url(../images/icons.gif) no-repeat;
    margin: 5px 1px 1px;
    cursor: pointer;
}
</style>
<script type="text/javascript" src="__PUBLIC__/uploadify/jquery.uploadify.min.js"></script>
<div class="easyui-accordion"  style="border-top:none;border-bottom:none;">
    <div title="会员基本信息"  style="overflow:auto;padding:4px;">
      <table  class="table-bordered" style="border-bottom:none;" width="100%">
        <tr>
          <td style="text-align:right;background-color:#f5f5f5;width:130px;line-height:30px;height:35px;">会员编号:</td> <td>&nbsp;{$info.customid}</td>
        </tr>
        <tr>  
          <td style="text-align:right;background-color:#f5f5f5;width:130px;line-height:30px;height:35px;"><font color="red">*</font>会员名称:</td>
          <td>&nbsp;<input class="easyui-textbox" type="text" id="editnamechinese" name="editnamechinese" style="width:170px;" value="{$info.namechinese}"></input></td>
        </tr>
        <tr>
          <td style="text-align:right;background-color:#f5f5f5;width:130px;line-height:30px;height:35px;">会员属性:</td>
          <td>              
              &nbsp;<select class="easyui-combobox" id="editcountrycode" name="editcountrycode" style="width:170px;">
                  <option value="建业业主" <if condition="$info.countrycode eq '建业业主'">selected="selected"</if>>建业业主</option>
                  <option value="酒店客户" <if condition="$info.countrycode eq '酒店客户'">selected="selected"</if>>酒店客户</option>
                  <option value="商业客户" <if condition="$info.countrycode eq '商业客户'">selected="selected"</if>>商业客户</option>
                  <option value="内部员工" <if condition="$info.countrycode eq '内部员工'">selected="selected"</if>>内部员工</option>
                  <option value="房装柜会员" <if condition="$info.countrycode eq '房装柜会员'">selected="selected"</if>>房装柜会员</option>
                  <option value="E+会员" <if condition="$info.countrycode eq 'E+会员'">selected="selected"</if>>E+会员</option>
                  <option value="君邻会会员" <if condition="$info.countrycode eq '君邻会会员'">selected="selected"</if>>君邻会会员</option>
                  <option value="football会员" <if condition="$info.countrycode eq 'football会员'">selected="selected"</if>>football会员</option>
                  <option value="南阳公司会员" <if condition="$info.countrycode eq '南阳公司会员'">selected="selected"</if>>南阳公司会员</option>
                  <option value="其他" <if condition="$info.countrycode eq '其他'">selected="selected"</if>>其他</option>
              </select>
          </td>
        </tr>
        <tr>      
          <td style="text-align:right;background-color:#f5f5f5;width:130px;line-height:30px;height:35px;"><font color="red">*</font>联系方式:</td>
          <td>&nbsp;<input class="easyui-textbox" type="text" id="editlinktel" name="editlinktel"  style="width:170px;" value="{$info.linktel}"></input></td>
        </tr>
        <tr>
          <td style="text-align:right;background-color:#f5f5f5;width:130px;line-height:30px;height:35px;"><font color="red">*</font>性别:</td>
          <td>
            &nbsp;<div id='editcustomssex'><label style="display: inline;"><input type="radio" name="editsex" value="男"<if condition="$info.sex eq '男'">checked="checked"</if>/>男</label>
            <label style="display: inline;"><input type="radio" name="editsex" value="女"<if condition="$info.sex eq '女'">checked="checked"</if>/>女</label>
            </div>
          </td>
        </tr>
        <tr>
          <td style="text-align:right;background-color:#f5f5f5;width:130px;line-height:30px;height:35px;"><font color="red">*</font>会员类型:</td>
          <td>              
              &nbsp;<select class="easyui-combobox" id="editcustomlevel" name="editcustomlevel" style="width:170px;">
                  <option value="一般客户">一般客户</option>
                  <option value="团购客户">团购客户</option>
              </select>
          </td>
        </tr>
        <tr>  
          <td style="text-align:right;background-color:#f5f5f5;width:130px;line-height:30px;height:35px;">证件类型:</td>
          <td>              
              &nbsp;<select class="easyui-combobox" id="editpersonidtype" name="editpersonidtype" style="width:170px;">
                  <option value="身份证">身份证</option>
                  <option value="护照">护照</option>
                  <option value="军官证">军官证</option>
              </select>
          </td>
        </tr>
        <tr>  
          <td style="text-align:right;background-color:#f5f5f5;width:130px;line-height:30px;height:35px;"><font color="red">*</font>证件号码:</td>
          <td>&nbsp;<input class="easyui-validatebox" type="text" id="editpersonid" name="editpersonid" style="width:170px;" value="{$info.personid}" onblur="personidblur()"></input></td>
        </tr>
        <tr>
          <td style="text-align:right;background-color:#f5f5f5;width:130px;line-height:30px;height:35px;"><font color="red">*</font>开户机构:</td>
          <td>
              <div>
                  &nbsp;<input class="easyui-combobox" type="text" id="editpname" name="editpname"  style="width:170px;" data-options="prompt:'请输入你想要查询的机构名称'" value="{$info.pname}"></input>
              </div>
              <div id="remind">
                  <ul id="key"></ul>
              </div>
          </td>
        </tr>
        <tr>  
          <td style="text-align:right;background-color:#f5f5f5;width:130px;line-height:30px;height:35px;"><font color="red">*</font>状态:</td> 
          <td>          
              &nbsp;<select class="easyui-combobox" id="editlinkman" name="editlinkman" style="width:170px;">
                  <option value="启用" <if condition="$info.linkman eq '启用'">selected="selected"</if>>启用</option>
                  <option value="不启用" <if condition="$info.linkman eq '启用'">selected="selected"</if>>不启用</option>
              </select>
          </td>

        </tr>
      </table>
    </div>
    </form>
    <div title="证件信息"  style="overflow:auto;padding:4px;">
      <table  class="table-bordered" style="border-bottom:none;" width="100%">
        <tr>
          <td style="text-align:right;background-color:#f5f5f5;width:130px;line-height:30px;height:35px;">所属省市:</td>
          <td>              
              &nbsp;
              <input class="easyui-combobox" id="editprovinceid" name="editprovinceid" style="width:170px;" value="{$current_proid}">
              <input class="easyui-combobox" id="editcityid" name="editcityid" style="width:170px;" value="{$info.cityid}">
              <input class="easyui-combobox" id="editcountyid" name="editcountyid" style="width:170px;" value="{$info.countyid}">
          </td>
        </tr>
        <tr>
          <td style="text-align:right;background-color:#f5f5f5;width:130px;line-height:30px;height:35px;">详细地址（常住地址）:</td>
          <td>&nbsp;<input class="easyui-textbox" type="text" id="editresidaddress" name="editresidaddress"  style="width:170px;" value="{$info.residaddress}"></input></td>
        </tr>
        <tr>
          <td style="text-align:right;background-color:#f5f5f5;width:130px;line-height:30px;height:35px;">邮编:</td>
          <td>&nbsp;<input class="easyui-textbox" type="text" id="editunitzip" name="editunitzip" style="width:170px;" value="{$info.unitzip}"></input></td>
        </tr>
        <tr>
          <td style="text-align:right;background-color:#f5f5f5;width:130px;">身份证正面照片:</td>
          <td>  
            <div style="padding:5px; Border:2px dashed #E6E6E6;">
              <div id="editqueue"></div>
              <input id="editfrontImg" name="editfrontImg" type="file" multiple="true"> 
              <div id='editbtn'>
                <a style="text-decoration:none;" id="editbtnUpload" href="javascript:$('#editfrontImg').uploadify('upload','*')">确认上传</a> &nbsp;|&nbsp;
                <a style="text-decoration:none;" id="editbtnCancelUpload" href="javascript:$('#editfrontImg').uploadify('cancel')">取消上传</a> &nbsp;&nbsp;
                <span id='editsuccesstext'></span>
              </div>  
              <ul class="filelist">
                <volist name='frontimg' id='vo' key="k">
                  <if condition="$vo neq ''">
                    <li><p class='title'></p><p class="imgWrap"><img src="/public{$vo}"></p><p class="progress"><span></span></p></li>
                  </if>
                </volist>
              </ul>
            </div>  
          </td>
        </tr>
        <tr>
          <td style="text-align:right;background-color:#f5f5f5;width:130px;">身份证反面照片:</td>
          <td>  
            <div style="padding:5px; Border:2px dashed #E6E6E6;">
              <div id="editqueue1"></div>
              <input id="editreserveimg" name="editreserveimg" type="file" multiple="true"> 
              <div id='editbtn1'>
                <a style="text-decoration:none;" id="editbtnUpload1" href="javascript:$('#editreserveimg').uploadify('upload','*')">确认上传</a> &nbsp;|&nbsp;
                <a style="text-decoration:none;" id="editbtnCancelUpload1" href="javascript:$('#editreserveimg').uploadify('cancel')">取消上传</a> &nbsp;&nbsp;
                <span id='editsuccesstext1'></span>
              </div>  
              <ul class="filelist1">
                <volist name='reserveimg' id='ko' key="k">
                  <if condition="$ko neq ''">
                    <li><p class='title'></p><p class="imgWrap"><img src="/public{$ko}"></p><p class="progress"><span></span></p></li>
                  </if>
                </volist>
              </ul>
            </div>  
          </td>
        </tr>
        <tr>
          <td style="text-align:right;background-color:#f5f5f5;width:130px;line-height:30px;height:35px;">证件有效期:</td>
          <td>&nbsp;<input class="easyui-datebox" type="text" id="editpersonidexdate" name="editpersonidexdate"  style="width:170px;" value="{$info.personidexdate}"></input></td>
        </tr>
      </table>
    </div>
    <div title="其他信息"  style="overflow:auto;padding:4px;">
      <table  class="table-bordered" style="border-bottom:none;" width='100%'>
        <tr>
          <td style="text-align:right;background-color:#f5f5f5;width:130px;line-height:30px;height:35px;">英文名称:</td>
          <td>&nbsp;<input class="easyui-textbox" type="text" id="editnameenglish" name="editnameenglish" style="width:170px;" value="{$info.nameenglish}"></input></td>
        </tr>
        <tr>
          <td style="text-align:right;background-color:#f5f5f5;width:130px;line-height:30px;height:35px;">生日:</td>
          <td>&nbsp;<input class="easyui-datebox" type="text" id="editbirthday" name="editbirthday"  style="width:170px;" value="{$info.birthday}"></input></td>
        </tr>
        <tr>
          <td style="text-align:right;background-color:#f5f5f5;width:130px;line-height:30px;height:35px;">E-mail:</td>
          <td>&nbsp;<input class="easyui-textbox" type="text" id="editemail" name="editemail"  style="width:170px;" value="{$info.email}"></input></td>
        </tr>
        <tr>
          <td style="text-align:right;background-color:#f5f5f5;width:130px;line-height:30px;height:35px;">收入:</td>
          <td>              
              &nbsp;<select class="easyui-combobox" id="editstaffpaper" name="editstaffpaper" style="width:170px;">
                  <option value="1" <if condition="$info.staffpaper eq 1">selected="selected"</if>>2000以下</option>
                  <option value="2" <if condition="$info.staffpaper eq 2">selected="selected"</if>>2000-3000</option>
                  <option value="3" <if condition="$info.staffpaper eq 3">selected="selected"</if>>3000-5000</option>
                  <option value="4" <if condition="$info.staffpaper eq 4">selected="selected"</if>>5000-8000</option>
                  <option value="5" <if condition="$info.staffpaper eq 4">selected="selected"</if>>8000-10000</option>
                  <option value="6" <if condition="$info.staffpaper eq 6">selected="selected"</if>>10000以上</option>
              </select>
          </td>
        </tr>
      </table>
    </div>
</div>
<input id="editfrontimgs" type='hidden' value='{$info.frontimg}'>
<input id="editreserveimgs" type='hidden'  value='{$info.reserveimg}'>
<div align="center" style="padding:4px;">
    <!-- <button type="button">保存</button> -->
    <a class="easyui-linkbutton" iconCls="icon-save" onClick="editCustoms()">保存</a>
</div> 
<!-- </form> -->
<input type="hidden" id='editcustomid' name="editcustomid" value="{$_GET['customid']}">
<script type="text/javascript">
    $(function(){
        $('#editpname').combobox({
            url:'../Common/getAllPnames',
            valueField:'panterid',
            textField:'namechinese'
        });
        $("#ui-datepicker-div").hide();
        //显示所有省份
        $("#editprovinceid").combobox({
            url:'../Common/getAllProvince',
            valueField:'provinceid',
            textField:'provincename',
            editable:true,//不可编辑，只能选择
            value:'{$current_proid}',
            onChange:function(){
              $('#editcityid').combobox({
                valueField:'cityid', //值字段
                textField:'cityname', //显示的字段
                url:'../Common/getAllCity?provinceid='+$('#editprovinceid').combobox('getValue'),
                editable:true,//不可编辑，只能选择
                value:'{$info.cityid}',
                onChange:function(){
                $('#editcountyid').combobox({
                    //显示县市区
                    valueField:'countyid', //值字段
                    textField:'countyname', //显示的字段
                    url:'../Common/getAllCounty?cityid='+$('#editcityid').combobox('getValue'),
                    editable:true,//不可编辑，只能选择
                    value:'{$info.countyid}',
                  });
                },
              });
            },
        });
        //显示城市
        $('#editcityid').combobox({
            valueField:'cityid', //值字段
            textField:'cityname', //显示的字段
            url:'../Common/getAllCity?provinceid='+$('#editprovinceid').combobox('getValue'),
            editable:true,//不可编辑，只能选择
        }); 
        //显示县、区
        $('#editcountyid').combobox({
          //显示县市区
          valueField:'countyid', //值字段
          textField:'countyname', //显示的字段
          url:'../Common/getAllCounty?cityid='+$('#editcityid').combobox('getValue'),
          editable:true,//不可编辑，只能选择
        });       
        //身份证修改验证是否唯一性
        $("#editpersonid").blur(function(){
          var personid=$.trim($('#personid').val());
          var customid = $.trim($("#customid").val());
          $.ajax({
            type:"post",
            url:"__URL__/editif",
            data:{'personid':personid,'customid':customid},
            dataType:"json",
            success:function(data){
              if(data.status==1)
              {
                alert(data.name);
              }  
            }
          })
        });
        //联系电话编辑时唯一性检验
        $("#editlinktel").change(function(){
          var linktel= $.trim($('#linktel').val());
          var customid = $.trim($("#customid").val());
          $.ajax({
            type:"post",
            url:"__URL__/linktelif",
            data:{'linktel':linktel,'customid':customid},
            dataType:"json",
            success:function(data){
              if(data.status==1)
              {
                alert(data.name);
              }
            }
          })
        })

        $('#editpersonid').blur(function(){
            var personid= $.trim($(this).val());
            if(personid.length<18){
                $('#editbirthday').val('');
                return;
            }
            var birth=personid.substr(6,8);
            var birthYear=personid.substr(6,4);
            var date=new Date();
            var currentYear=date.getFullYear();
            if(birthYear<1930&&birthYear>currentYear){
                $('#editbirthday').val('');
                alert('非法身份证');return;
            }
            $('#editbirthday').val(birth);
        });
        $('#editfrontImg').uploadify({
          'formData'     : {
            'timestamp' : '<?php echo $timestamp;?>',
            'token'     : '<?php echo md5('unique_salt' . $timestamp);?>'
          },
          'swf'      : '__PUBLIC__/uploadify/uploadify.swf',
          'uploader' : 'savePic',
          'buttonText' : '选择文件',
          'auto'     : false,
          'queueSizeLimit': 2, //队列最多可上传文件数量，默认为999 
          'multi': true,//是否为多选，默认为true
          'fileSizeLimit': '2MB',
          'fileTypeExts': '*.gif; *.jpg; *.png; *.bmp',
          'removeCompleted' : false,
          'width'   : 80,
          'height'  : 22,
          'sizeLimit': 2048000,
              'onUploadSuccess' : uploadPicture,
              'onQueueComplete' : function(queueData) {
            //$('#successtext').html("<font style='color:green;'>"+queueData.uploadsSuccessful+"个文件上传成功!</font>")
              }
        });
        $('#editreserveimg').uploadify({
          'formData'     : {
            'timestamp' : '<?php echo $timestamp;?>',
            'token'     : '<?php echo md5('unique_salt' . $timestamp);?>'
          },
          'swf'      : '__PUBLIC__/uploadify/uploadify.swf',
          'uploader' : 'savePic',
          'buttonText' : '选择文件',
          'auto'     : false,
          'queueSizeLimit': 2, //队列最多可上传文件数量，默认为999 
          'multi': true,//是否为多选，默认为true
          'fileSizeLimit': '2MB',
          'fileTypeExts': '*.gif; *.jpg; *.png; *.bmp',
          'removeCompleted' : false,
          'width'   : 80,
          'height'  : 22,
          'sizeLimit': 2048000,
              'onUploadSuccess' : uploadPicture1,
              'onQueueComplete' : function(queueData) {
            //$('#successtext').html("<font style='color:green;'>"+queueData.uploadsSuccessful+"个文件上传成功!</font>")
              }
        });
          
      function uploadPicture(file, data){
        var data = $.parseJSON(data);
        if(data.status){
          $('#' + file.id).find('.data').html('<font style="color:green; padding-left:10px;">上传完毕</font>')
          imgObj = "<li id='file_"+file.id+"'><p class='title'>"+data.info.savename+"</p><p class='imgWrap'><img src='/public"+data.info.savepath + "thumb_"+data.info.savename+"' /></p><p class='progress'><span></span></p></li>";
          // <div class='file-panel' style='height: 20px;'><input type='button' value='删除'></div>
          $('.filelist').append(imgObj);   
          var str=$('#editfrontimgs').val();
          if(str==''){
             str=str+data.info.savepath+"thumb_"+data.info.savename;
           }else{
             str=str+","+data.info.savepath+"thumb_"+data.info.savename;
           }
          $('#editfrontimgs').val(str);
        } else {
          $('.filelist').append(data.info);
        }       
      }
      function uploadPicture1(file, data){
        var data = $.parseJSON(data);
        if(data.status){
          $('#' + file.id).find('.data').html('<font style="color:green; padding-left:10px;">上传完毕</font>')
          imgObj = "<li id='file_"+file.id+"'><p class='title'>"+data.info.savename+"</p><p class='imgWrap'><img src='/public"+data.info.savepath + "thumb_"+data.info.savename+"' /></p><p class='progress'><span></span></p></li>";
          // <div class='file-panel' style='height: 20px;'><input type='button' value='删除'></div>
          $('.filelist1').append(imgObj);   
          var str=$('#editreserveimgs').val();
          if(str==''){
             str=str+data.info.savepath+"thumb_"+data.info.savename;
           }else{
             str=str+","+data.info.savepath+"thumb_"+data.info.savename;
           }
          $('#editreserveimgs').val(str);
        } else {
          $('.filelist1').append(data.info);
        }       
      }
      // $(".filelist").on("click","li", function() {
      //   var imgUrl = $(this).find('img').attr('src');
      //   var imgUrl2 = imgUrl.replace(/thumb_/ig, '');
      //   var re = /,{1,}/g;
      //   var b=$('#frontimgs1').val();
      //   var a=imgUrl.replace('/public','');
      //   var c=b.replace(a,'');
      //   var d=c.replace(re,',');
      //   // d=d.replace(/,$/g,"");
      //   //reserveimg
      //   var e=$('#reserveimgs1').val();
      //   var f=imgUrl2.replace('/public','');
      //   var g=e.replace(f,'');
      //   var h=g.replace(re,',');
      //   // h=h.replace(/,$/g,"");
      //   $(this).remove();
      //   $.ajax({
      //     type : "POST",
      //     url : "delPic",
      //     data : {
      //       "url" : imgUrl,
      //       "url2": imgUrl2
      //     },
      //     success : function(data) {
      //       if(data.status == 1) {
      //         alert("删除成功");
      //       }else{
      //         if(d!==''){
      //           $('#frontimgs1').val(d);
      //         }else{
      //           $('#frontimgs1').val("");
      //         }            
      //         if(h!==''){
      //           $('#reserveimgs1').val(h);
      //         }else{
      //           $('#reserveimgs1').val("");
      //         }
      //         alert("删除失败");
      //       }
      //     }
      //   });
      // });
    });
    //根据身份证号码提取生日
    function personidblur(){
      var personid= $.trim($("#editpersonid").val());
      if(personid.length<18){
          $('#editbirthday').val('');
          return;
      }
      var birth=personid.substr(6,8);
      var birthYear=personid.substr(6,4);
      var date=new Date();
      var currentYear=date.getFullYear();
      if(birthYear<1930&&birthYear>currentYear){
          $('#editbirthday').val('');
          alert('非法身份证');return;
      }
      var a=birth.substr(0,4);
      var b=birth.substr(4,2);
      var c=birth.substr(6,2);
      birth=a+'-'+b+'-'+c;
      $('#editbirthday').datebox('setValue',birth);
      if(personid!="")
      {
        $.ajax({
           url:"__URL__/addpersonid",
           type:"post",
           data:{personid:personid},
           dataType:"json",
           success:function(data){
             if(data.status==1)
             {
               alert(data.name);
               return false;
             }
           }
        })
      }
    }
    //编辑时保持信息
    function editCustoms(){
      /*var o={};
      var reg;
      reg=/^[\u4e00-\u9fa5]+$/;
      o.namechinese=$("#editnamechinese").textbox('getValue');
      if(o.namechinese==''||o.namechinese=='undefined'){
        alert('会员名称必须填写');
        return false;
      }
      if(reg.test(o.namechinese)){
        
      }else{
        alert('会员名称必须为中文');
        return false;
      }
      o.countrycode=$('#editcountrycode').combobox('getValue');
      o.linktel=$('#editlinktel').textbox('getValue');
      if(o.linktel==''||o.linktel=='undefined'){
        alert('联系方式必须填写');
        return false;
      }
      if(o.linktel && /^1[3|4|5|8]\d{9}$/.test(o.linktel)){
        //对的
      } else{
        //不对
        alert('手机号格式不正确');
        return false;
      } 
      o.sex=$('#editcustomssex input[name="editsex"]:checked').val();
      if(o.sex==''||o.sex=='undefined'){
        alert('性别必须选择');
        return false;
      }
      o.customlevel=$('#editcustomlevel').combobox('getValue');
      o.personidtype=$('#editpersonidtype').combobox('getValue');
      o.personid=$('#editpersonid').val();
      if(o.personid==''||o.personid=='undefined'){
        alert('证件号码必须填写');
        return false;
      }
      if(o.personid && /(^\d{15}$)|(^\d{18}$)|(^\d{17}(\d|X|x)$)/.test(o.personid)){
        //对的
      } else{
        //不对
        alert('身份证号格式不正确');
        return false;
      } 
      o.pname=$('#editpname').combobox('getValue');
      o.linkman=$('#editlinkman').combobox('getValue');
      o.provinceid=$('#editprovinceid').combobox('getValue');
      o.cityid=$('#editcityid').combobox('getValue');
      o.countyid=$('#editcountyid').combobox('getValue');
      o.residaddress=$('#editresidaddress').textbox('getValue');
      o.unitzip=$('#editunitzip').textbox('getValue');
      o.personidexdate=$('#editpersonidexdate').textbox('getValue');
      o.nameenglish=$('#editnameenglish').textbox('getValue');
      o.birthday=$('#editbirthday').datebox('getValue');
      o.email=$('#editemail').textbox('getValue');
      o.staffpaper=$('#editstaffpaper').combobox('getValue');
      o.frontimgs=$('#editfrontimgs').val();
      o.reserveimgs=$('#editreserveimgs').val();
      $.ajax({
           type: "post",
           url: "saveCustoms?customid=" + $("#editcustomid").val(),
           data: o,
           fileElementId:'frontImg',
           dataType:'json',
           success: function(data){
              // alert(JSON.stringify(data));
              if(data.status==1){
                alert(data.info);
                $('#dialog_details').window('close');
                // $('#decorationTabs').tabs('getSelected').panel('refresh');
                $('#customsList').datagrid('reload');
              }else{
                alert(data.info);
              }
           }
      })*/
    }

    function addVal(a,id,pid){
        var value=$(a).text();
        $('#'+id).siblings('input').val(pid);
        $('#'+id).val(value);
        $(a).parent().parent().css('display','none')
    }
    function personReg(obj){
        obj.value=obj.value.replace(/[^\dX]+/g,'');
    }
    //图片
    function gx_idcard(x,y){
      var objUrl = getObjectURL(y.files[0]) ;
      console.log("objUrl = "+objUrl) ;
      if (objUrl) {
        $("#"+x).attr("src", objUrl) ;
      }
    }
    function getObjectURL(file) {
      var url = null ;
      if (window.createObjectURL!=undefined) { // basic
        url = window.createObjectURL(file) ;
      } else if (window.URL!=undefined) { // mozilla(firefox)
        url = window.URL.createObjectURL(file) ;
      } else if (window.webkitURL!=undefined) { // webkit or chrome
        url = window.webkitURL.createObjectURL(file) ;
      }
      return url ;
    }
</script>
