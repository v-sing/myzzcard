<style>
  table {
    max-width: 100%;
    background-color: transparent;
    border-spacing: 0;
  }
  .table-bordered {
    border: 1px solid #dddddd;
    border-collapse: separate;
    border-left: 0;
    border-radius: 4px;
  }
  .table th, .table td {
    padding: 8px;
    vertical-align: top;
    border-top: 1px solid #dddddd;
  }
  .table td, .table th {
    padding-top: 8px;
    padding-bottom: 4px;
    line-height: 20px;
    height: 25px;
  }
  .table-bordered th, .table-bordered td {
    border-left: 1px solid #dddddd;
  }
  tr {
    display: table-row;
    vertical-align: inherit;
    border-color: inherit;
    }
  td, th {
    border-bottom:1px solid #dddddd;
    display: table-cell;
  }
</style>
<form method="post" id="editform" enctype="multipart/form-data">
<div class="easyui-accordion"  style="border-top:none;border-bottom:none;">
    <div title="商户基本信息"  style="overflow:auto;padding:4px;">
      <table  class="table-bordered" style="border-bottom:none;" width="100%">
        <tr>
          <td style="text-align:right;background-color:#f5f5f5;width:130px;line-height:30px;height:35px;"><font color="red">*</font>商户名称:</td>
          <td>&nbsp;<input class="easyui-textbox" type="text" id="addnamechinese" name="addnamechinese" style="width:170px;"/></td>
        </tr>
        <tr>
          <td style="text-align:right;background-color:#f5f5f5;width:130px;line-height:30px;height:35px;"><font color="red">*</font>商户地址:</td>
          <td>&nbsp;<input class="easyui-textbox" type="text" id="addaddress" name="addaddress" style="width:170px;"/></td>
        </tr>
        <tr>
          <td style="text-align:right;background-color:#f5f5f5;width:130px;line-height:30px;height:35px;"><font color="red">*</font>经营范围:</td>
          <td>&nbsp;<input class="easyui-textbox" type="text" id="addoperatescope" name="addoperatescope" style="width:170px;"/></td>
        </tr>
        <tr>
          <td style="text-align:right;background-color:#f5f5f5;width:130px;line-height:30px;height:35px;"><font color="red">*</font>组织机构代码:</td>
          <td>&nbsp;<input class="easyui-textbox" type="text" id="addoragnizationcode" name="addoragnizationcode" style="width:170px;"/></td>
        </tr>
        <tr>
          <td style="text-align:right;background-color:#f5f5f5;width:130px;line-height:30px;height:35px;"><font color="red">*</font>营业执照:</td>
          <td>&nbsp;<input class="easyui-textbox" type="text" id="addbusiness" name="addbusiness" style="width:170px;"/></td>
        </tr>
        <tr>
          <td style="text-align:right;background-color:#f5f5f5;width:130px;line-height:30px;height:35px;"><font color="red">*</font>税务登记:</td>
          <td>&nbsp;<input class="easyui-textbox" type="text" id="addtaxation" name="addtaxation" style="width:170px;"/></td>
        </tr>
        <tr>
          <td style="text-align:right;background-color:#f5f5f5;width:130px;line-height:30px;height:35px;"><font color="red">*</font>商户简称:</td>
          <td>&nbsp;<input class="easyui-textbox" type="text" id="addnameenglish" name="addnameenglish" style="width:170px;"/></td>
        </tr>
        <tr>
          <td style="text-align:right;background-color:#f5f5f5;width:130px;line-height:30px;height:35px;"><font color="red">*</font>所属省市:</td>
            <td>
                &nbsp;
                <input class="easyui-combobox" id="editprovinceid" name="addprovinceid" style="width:170px;" value="{$info.provinceid}">
                <input class="easyui-combobox" id="editcityid" name="addcityid" style="width:170px;" value="{$info.cityid}">
            </td>
        </tr>
        <tr>
          <td style="text-align:right;background-color:#f5f5f5;width:130px;line-height:30px;height:35px;">营业电话:</td>
          <td>&nbsp;<input class="easyui-textbox" type="text" id="addgoingteleno" name="addgoingteleno" style="width:170px;"/></td>
        </tr>
        <tr>
          <td style="text-align:right;background-color:#f5f5f5;width:130px;line-height:30px;height:35px;"><font color="red">*</font>所属机构:</td>
          <td>&nbsp;<select class="easyui-combobox" id="addparent" name="addparent" style="width:170px;">
                        <foreach name='parents' item='val'>
                          <option value="{$val.panterid}">{$val.namechinese}</option>
                        </foreach>
                   </select>
        </td>
        </tr>
        <tr>
          <td style="text-align:right;background-color:#f5f5f5;width:130px;line-height:30px;height:35px;"><font color="red">*</font>所属商圈:</td>
          <td>&nbsp;<select class="easyui-combobox" id="addpantergroup" name="addpantergroup" style="width:170px;">
                        <foreach name='pantergroups' item='val'>
                          <option value="{$val.groupid}">{$val.groupname}</option>
                        </foreach>
                   </select>
        </td>
        </tr>
        <tr>
          <td style="text-align:right;background-color:#f5f5f5;width:130px;line-height:30px;height:35px;"><font color="red">*</font>行业属性:</td>
          <td>&nbsp;<select class="easyui-combobox" id="addhysx" name="addhysx" style="width:170px;">
                        <foreach name='hysxs' item='val'>
                          <option value="{$val}">{$val}</option>
                        </foreach>
                   </select>
        </td>
        </tr>
        <tr>
          <td style="text-align:right;background-color:#f5f5f5;width:130px;line-height:100px;height:100px;"><font color="red">*</font>营业执照:</td>
          <td>
            <div id="box">
            	<div id="test" ></div>
            </div>
          </td>
        </tr>
        <tr>
          <td style="text-align:right;background-color:#f5f5f5;width:130px;line-height:100px;height:100px;"><font color="red">*</font>商户门头:</td>
          <td>
            <div id="box">
            	<div id="test" ></div>
            </div>
          </td>
        </tr>
        <tr>
          <td style="text-align:right;background-color:#f5f5f5;width:130px;line-height:30px;height:35px;"><font color="red">*</font>撤消状态:</td>
          <td>&nbsp;<select class="easyui-combobox" id="addrevorkflg" name="addrevorkflg" style="width:170px;">
                        <foreach name='revork' item='val' key='k'>
                          <option value="{$k}" <if condition="$info['revorkflg'] eq $k">selected="selected"</if>>{$val}</option>
                        </foreach>
                   </select>
        </td>
        </tr>
      </table>
    </div>
    <!-- </form> -->
    <div title="联系人信息"  style="overflow:auto;padding:4px;">
      <table  class="table-bordered" style="border-bottom:none;" width="100%">
        <tr>
          <td style="text-align:right;background-color:#f5f5f5;width:130px;line-height:30px;height:35px;">法人代表:</td>
          <td>&nbsp;<input class="easyui-textbox" type="text" id="addlegalperson" name="addlegalperson"  style="width:170px;"/></td>
        </tr>
        <tr>
          <td style="text-align:right;background-color:#f5f5f5;width:130px;line-height:30px;height:35px;">证件类型:</td>
          <td>&nbsp;
                  <select class="easyui-combobox" id="addconperbtype" name="addconperbtype" style="width:170px;">
                       <option value="身份证">身份证</option>
                       <option value="护照">护照</option>
                       <option value="军官证">军官证</option>
                   </select>
          </td>
        </tr>
        <tr>
          <td style="text-align:right;background-color:#f5f5f5;width:130px;line-height:30px;height:35px;">法人代表证件号:</td>
          <td>&nbsp;<input class="easyui-textbox" type="text" id="editunitzip" name="editunitzip" style="width:170px;" value="{$info.conperbpno}"></input></td>
        </tr>
        <tr>
          <td style="text-align:right;background-color:#f5f5f5;width:130px;">证件正面照片:</td>
          <td>
              <input type="file" name="frontImg0" onchange="gx_idcard('frontImg',this)" />
              <empty name="info.frontimg">
                <img style="height:120px;" id="frontImg" />
              <else />
                <img src="__PUBLIC__/{$info.frontimg}" style="height:120px;" id="frontImg" />
              </empty>
          </td>
        </tr>
        <tr>
          <td style="text-align:right;background-color:#f5f5f5;width:130px;">证件反面照片:</td>
          <td>
              <input type="file" name="reserveImg" onchange="gx_idcard('reserveImg',this)"/>
              <empty name="info.reserveimg">
                <img style="height:120px;" id="reserveImg" />
              <else />
                <img src="__PUBLIC__/{$info.reserveimg}" style="height:120px;" id="reserveImg" />
              </empty>
          </td>
        </tr>
        <tr>
          <td style="text-align:right;background-color:#f5f5f5;width:130px;line-height:30px;height:35px;">法人代表手机:</td>
          <td>&nbsp;<input class="easyui-textbox" type="text" id="addconpermobno" name="addconpermobno"  style="width:170px;"/></td>
        </tr>
        <tr>
          <td style="text-align:right;background-color:#f5f5f5;width:130px;line-height:30px;height:35px;">证件有效期:</td>
          <td>&nbsp;<input class="easyui-datebox" type="text" id="addperiod" name="addperiod"  style="width:170px;"/></td>
        </tr>
        <tr>
          <td style="text-align:right;background-color:#f5f5f5;width:130px;line-height:30px;height:35px;">常用联系人:</td>
          <td>&nbsp;<input class="easyui-textbox" type="text" id="addconpername" name="addconpername"  style="width:170px;"></td>
        </tr>
        <tr>
          <td style="text-align:right;background-color:#f5f5f5;width:130px;line-height:30px;height:35px;">常用联系人电话:</td>
          <td>&nbsp;<input class="easyui-textbox" type="text" id="addconperteleno" name="addconperteleno"  style="width:170px;"/></td>
        </tr>
      </table>
    </div>
    <div title="商户风险控制"  style="overflow:auto;padding:4px;">
      <table  class="table-bordered" style="border-bottom:none;" width='100%'>
        <tr>
          <td style="text-align:right;background-color:#f5f5f5;width:130px;line-height:30px;height:35px;">每日消费限制:</td>
          <td>&nbsp;<input class="easyui-textbox" type="text" id="addd_sum_account" name="addd_sum_account" style="width:170px;"/></td>
        </tr>
        <tr>
          <td style="text-align:right;background-color:#f5f5f5;width:130px;line-height:30px;height:35px;">每日消费次数:</td>
          <td>&nbsp;<input class="easyui-textbox" type="text" id="addd_sum_number" name="addd_sum_number"  style="width:170px;"/></td>
        </tr>
        <tr>
          <td style="text-align:right;background-color:#f5f5f5;width:130px;line-height:30px;height:35px;">每笔刷卡限额:</td>
          <td>&nbsp;<input class="easyui-textbox" type="text" id="addd_one_account" name="addd_one_account"  style="width:170px;"></td>
        </tr>
      </table>
    </div>
    <div title="通宝相关"  style="overflow:auto;padding:4px;">
      <table  class="table-bordered" style="border-bottom:none;" width='100%'>
        <tr>
            <td style="text-align:right;background-color:#f5f5f5;width:130px;line-height:30px;height:35px;">参与通宝项目:</td>
            <td><select class="easyui-combobox" name="addtongbaoitem" id="addtongbaoitem">
                  <option value="">请选择</option>
                  <option value="Y" <if condition="$info['tongbaoitem'] eq Y">selected</if> >参与项目</option>
                  <option value="N" <if condition="$info['tongbaoitem'] eq N">selected</if> >不参与</option>
               </select>
             </td>
        </tr>
        <tr>
          <td style="text-align:right;background-color:#f5f5f5;width:130px;line-height:30px;height:35px;">通宝比例:</td>
          <td>&nbsp;<input class="easyui-textbox" type="text" id="tongbao_rate" name="tongbao_rate"  style="width:170px;" value="{$info.tongbao_rate}"></input></td>
        </tr>
        <tr>
          <td style="text-align:right;background-color:#f5f5f5;width:130px;line-height:70px;height:70px;">房掌柜数据同步:</td>
          <td>
            <input type="checkbox" id="syncfz" style="width:20px;height:14px;" name="addsyncfz" id="addsyncfz" value="1"/>
            收银一体化
            <br/>
            <input type="checkbox" id="syncfz"  style="width:20px;height:14px;" name="addsyncfz" id="addsyncfz" value="1"/>
            房掌柜
          </td>
        </tr>
      </table>
    </div>
</div>
<div align="center" style="padding:4px;">
    <!-- <button type="button">保存</button> -->
    <a class="easyui-linkbutton" iconCls="icon-save" onClick="editCustoms()">保存</a>
</div>
</form>
<input type="hidden" id='editcustomid' name="editcustomid" value="{$_GET['customid']}">
<script type="text/javascript">
    $(function(){
        $('#editpname').combobox({
            url:'../Common/getAllPnames',
            valueField:'panterid',
            textField:'namechinese'
        });
        $("#ui-datepicker-div").hide();
        //显示所有省份
        $("#editprovinceid").combobox({
            url:'../Common/getAllProvince',
            valueField:'provinceid',
            textField:'provincename',
            editable:true,//不可编辑，只能选择
            value:'{$current_proid}',
            onChange:function(){
              $('#editcityid').combobox({
                valueField:'cityid', //值字段
                textField:'cityname', //显示的字段
                url:'../Common/getAllCity?provinceid='+$('#editprovinceid').combobox('getValue'),
                editable:true,//不可编辑，只能选择
                value:'{$info.cityid}',
                onChange:function(){
                $('#editcountyid').combobox({
                    //显示县市区
                    valueField:'countyid', //值字段
                    textField:'countyname', //显示的字段
                    url:'../Common/getAllCounty?cityid='+$('#editcityid').combobox('getValue'),
                    editable:true,//不可编辑，只能选择
                    value:'{$info.countyid}',
                  });
                },
              });
            },
        });
        //显示城市
        $('#editcityid').combobox({
            valueField:'cityid', //值字段
            textField:'cityname', //显示的字段
            url:'../Common/getAllCity?provinceid='+$('#editprovinceid').combobox('getValue'),
            editable:true,//不可编辑，只能选择
        });
        //显示县、区
        $('#editcountyid').combobox({
          //显示县市区
          valueField:'countyid', //值字段
          textField:'countyname', //显示的字段
          url:'../Common/getAllCounty?cityid='+$('#editcityid').combobox('getValue'),
          editable:true,//不可编辑，只能选择
        });
        //身份证修改验证是否唯一性
        $("#editpersonid").blur(function(){
          var personid=$.trim($('#personid').val());
          var customid = $.trim($("#customid").val());
          $.ajax({
            type:"post",
            url:"__URL__/editif",
            data:{'personid':personid,'customid':customid},
            dataType:"json",
            success:function(data){
              if(data.status==1)
              {
                alert(data.name);
              }
            }
          })
        });
        //联系电话编辑时唯一性检验
        $("#editlinktel").change(function(){
          var linktel= $.trim($('#linktel').val());
          var customid = $.trim($("#customid").val());
          $.ajax({
            type:"post",
            url:"__URL__/linktelif",
            data:{'linktel':linktel,'customid':customid},
            dataType:"json",
            success:function(data){
              if(data.status==1)
              {
                alert(data.name);
              }
            }
          })
        })

        $('#editpersonid').blur(function(){
            var personid= $.trim($(this).val());
            if(personid.length<18){
                $('#editbirthday').val('');
                return;
            }
            var birth=personid.substr(6,8);
            var birthYear=personid.substr(6,4);
            var date=new Date();
            var currentYear=date.getFullYear();
            if(birthYear<1930&&birthYear>currentYear){
                $('#editbirthday').val('');
                alert('非法身份证');return;
            }
            $('#editbirthday').val(birth);
        });
    });
    //新增时保持信息
    function editCustoms(){
      // alert('1');
      ajaxFileUpload();
      var o={};
      var reg;
      reg=/^[\u4e00-\u9fa5]+$/;
      o.namechinese=$("#editnamechinese").textbox('getValue');
      if(o.namechinese==''||o.namechinese=='undefined'){
        alert('会员名称必须填写');
        return false;
      }
      if(reg.test(o.namechinese)){

      }else{
        alert('会员名称必须为中文');
        return false;
      }
      o.countrycode=$('#editcountrycode').combobox('getValue');
      o.linktel=$('#editlinktel').textbox('getValue');
      if(o.linktel==''||o.linktel=='undefined'){
        alert('联系方式必须填写');
        return false;
      }
      if(o.linktel && /^1[3|4|5|8]\d{9}$/.test(o.linktel)){
        //对的
      } else{
        //不对
        alert('手机号格式不正确');
        return false;
      }
      o.sex=$('#editcustomssex input[name="editsex"]:checked').val();
      if(o.sex==''||o.sex=='undefined'){
        alert('性别必须选择');
        return false;
      }
      o.customlevel=$('#editcustomlevel').combobox('getValue');
      o.personidtype=$('#editpersonidtype').combobox('getValue');
      o.personid=$('#editpersonid').textbox('getValue');
      if(o.personid==''||o.personid=='undefined'){
        alert('证件号码必须填写');
        return false;
      }
      if(o.personid && /(^\d{15}$)|(^\d{18}$)|(^\d{17}(\d|X|x)$)/.test(o.personid)){
        //对的
      } else{
        //不对
        alert('身份证号格式不正确');
        return false;
      }
      o.pname=$('#editpname').combobox('getValue');
      o.linkman=$('#editlinkman').combobox('getValue');
      o.provinceid=$('#editprovinceid').combobox('getValue');
      o.cityid=$('#editcityid').combobox('getValue');
      o.countyid=$('#editcountyid').combobox('getValue');
      o.residaddress=$('#editresidaddress').textbox('getValue');
      o.unitzip=$('#editunitzip').textbox('getValue');
      o.personidexdate=$('#editpersonidexdate').textbox('getValue');
      o.nameenglish=$('#editnameenglish').textbox('getValue');
      o.birthday=$('#editbirthday').textbox('getValue');
      o.email=$('#editemail').textbox('getValue');
      o.staffpaper=$('#editstaffpaper').combobox('getValue');
      $.ajax({
           type: "post",
           url: "saveCustoms?customid=" + $("#editcustomid").val(),
           data: o,
           fileElementId:'frontImg',
           dataType:'json',
           success: function(data){
              // alert(JSON.stringify(data));
              if(data.status==1){
                alert(data.info);
                $('#dialog_details').window('close');
                // $('#decorationTabs').tabs('getSelected').panel('refresh');
                $('#customsList').datagrid('reload');
              }else{
                alert(data.info);
              }
           }
      })
    }

    // function ajaxFileUpload() {
    //   $.ajaxFileUpload
    //   (
    //     {
    //       url: 'savePic', //用于文件上传的服务器端请求地址
    //       secureuri: false, //是否需要安全协议，一般设置为false
    //       fileElementId: 'frontImg0', //文件上传域的ID
    //       dataType: 'json', //返回值类型 一般设置为json
    //       type:'post',
    //       success: function (data)  //服务器成功响应处理函数
    //       {
    //              // $("#returncontent").html(msg);
    //       },
    //       error: function (data, status, e)//服务器响应失败处理函数
    //       {
    //           alert(e);
    //       }
    //     }
    //   )
    //   return false;
    // }

    function addVal(a,id,pid){
        var value=$(a).text();
        $('#'+id).siblings('input').val(pid);
        $('#'+id).val(value);
        $(a).parent().parent().css('display','none')
    }
    function personReg(obj){
        obj.value=obj.value.replace(/[^\dX]+/g,'');
    }
    //图片
    function gx_idcard(x,y){
      var objUrl = getObjectURL(y.files[0]) ;
      console.log("objUrl = "+objUrl) ;
      if (objUrl) {
        $("#"+x).attr("src", objUrl) ;
      }
    }
    function getObjectURL(file) {
      var url = null ;
      if (window.createObjectURL!=undefined) { // basic
        url = window.createObjectURL(file) ;
      } else if (window.URL!=undefined) { // mozilla(firefox)
        url = window.URL.createObjectURL(file) ;
      } else if (window.webkitURL!=undefined) { // webkit or chrome
        url = window.webkitURL.createObjectURL(file) ;
      }
      return url ;
    }
</script>
